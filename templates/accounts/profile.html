{% extends 'accounts/base.html' %}
{% block content %}
<style>
    /* Page background - light blue gradient */
    body {
        background: linear-gradient(135deg, #cce7ff 0%, #99d1ff 100%);
        min-height: 100vh;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Card styling */
    .card {
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        background-color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(5px);
    }

    h3 {
        color: #1c7ed6;
        text-shadow: 1px 1px 5px rgba(0,0,0,0.2);
    }

    .avatar-preview {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 3px solid #1c7ed6;
        object-fit: cover;
        margin-bottom: 15px;
    }

    /* Hide help texts and clear checkboxes by default */
    .form-text, input[type="checkbox"] {
        display: none;
    }

    /* Error popup styling */
    .error-popup {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #ff6b6b;
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        display: none;
        z-index: 1000;
    }
</style>

<div class="row justify-content-center">
  <div class="col-md-6">
    <div class="card p-4 mt-4">
      <h3 class="text-center mb-4">Your Profile</h3>
      
      {% if user.profile.avatar %}
        <img src="{{ user.profile.avatar.url }}" class="avatar-preview d-block mx-auto" alt="Avatar">
      {% else %}
        <img src="https://via.placeholder.com/120" class="avatar-preview d-block mx-auto" alt="Avatar">
      {% endif %}

      <form method="post" enctype="multipart/form-data" id="profileForm">
        {% csrf_token %}
        <h5 class="mt-3">User Info</h5>
        {{ u_form.as_p }}
        <h5>Profile Info</h5>
        {{ p_form.as_p }}
        <button type="submit" class="btn btn-success w-100 mt-3">Update Profile</button>
      </form>
    </div>
  </div>
</div>

<!-- Popup for errors -->
<div class="error-popup" id="errorPopup">Please correct the highlighted fields!</div>

<script>
    document.getElementById('profileForm').addEventListener('submit', function(event) {
        let valid = true;
        const inputs = this.querySelectorAll('input, select, textarea');

        // Loop through inputs to check validity
        inputs.forEach(function(input) {
            const helpText = input.closest('p')?.querySelector('.form-text');
            if (!input.checkValidity()) {
                valid = false;
                if (helpText) helpText.style.display = 'block'; // Show help text if invalid
                if (input.type === 'file') {
                    // Show "clear" checkbox for file if invalid
                    const clearCheckbox = input.closest('p')?.querySelector('input[type="checkbox"]');
                    if (clearCheckbox) clearCheckbox.style.display = 'inline-block';
                }
            } else {
                if (helpText) helpText.style.display = 'none';
            }
        });

        if (!valid) {
            event.preventDefault();
            const popup = document.getElementById('errorPopup');
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 3000);
        }
    });
</script>
{% endblock %}
